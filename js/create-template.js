class CreateTemplateBlock{constructor(e,t,s){l=l.bind(this),this.changeSlide=this.changeSlide.bind(this),this.onSlideChange=this.onSlideChange.bind(this),this.saveControlChecks=this.saveControlChecks.bind(this),this.setImageFilename=this.setImageFilename.bind(this),this.rootElem=document.querySelector(`${e}`),this.selector=e,this.otherParams={renderPosition:"start",name:""};for(let e in s)this.otherParams[e]=s[e];function l(){setTimeout((()=>{const e=new URL(window.location.href).searchParams.get(this.otherParams.name),t=this.sliderContainer.querySelector(`[data-steps-slider-value="${e}"]`).dataset.sliderSlideIndex;this.sliderInstance.setSlidesWidth(),this.sliderInstance.slideTo(this.sliderContainer,t),this.sliderContainer.removeEventListener("sliderinit",l)}),750)}this.renderPosition="start"===this.otherParams.renderPosition?"afterbegin":"beforeend",this.getParams(t).then((()=>{this.hasSlider=!Array.isArray(this.params),this.renderTemplateBlockBody(),this.hasSlider&&(this.sliderContainer=this.rootElem.querySelector(".slider"),this.sliderContainer.addEventListener("sliderinit",l))}))}getParams(e){return new Promise((t=>{e?"object"==typeof e?(this.params=e,t()):"string"==typeof e&&loadData(e).then((e=>{this.params=e,t()})):(this.params={},t())}))}renderTemplateBlockBody(){t=t.bind(this),s=s.bind(this),l=l.bind(this),i=i.bind(this),n=n.bind(this);const e=`\n            <div class="template-block__body">\n                ${function(){if(this.hasSlider){let e="";return this.params.controlItems.forEach((t=>{e+=`\n                    <li class="template-block__slide slider__slide" data-steps-slider-value="${t.value}">\n                        <img class="template-block__image"\n                            src="${this.otherParams.pathToImg}${t.value}/" alt="${this.otherParams.imgAlt}">\n                    </li>\n                    `})),`\n                <div class="template-block__slider slider">\n                    <ul class="template-block__slider-list slider__list">\n                        ${e}\n                    </ul>\n                </div>\n                `}return`\n                <div class="template-block__preview">\n                    <img src="${this.otherParams.pathToImg}" alt="${this.otherParams.imgAlt}" class="template-block__preview-image">\n                </div>\n                `}.call(this)}\n                ${function(){let e="";this.hasSlider&&(e+=this.getControls(this.params));return`\n                <div class="template-block__controls">\n                    ${e}\n                </div>\n            `}.call(this)}\n            </div>\n        `;function t(){this.sliderInstance=sliders.find((e=>e.sliders.includes(this.sliderContainer))),this.sliderContainer.removeEventListener("sliderinit",t)}function s(e){const t=e.target,s=t.value;this.changeSlide(s),this.mainValue=s,this.currentSlideRadio=t,this.renderTemplateBlockControls()}function l(e){return e.parentNode.querySelector("input").value===this.currentSlideRadio.value}function i(e){const t=e.currentTarget;if(l(t))return;const s=t.parentNode.querySelector("input").value,i=this.rootElem.querySelector(`[data-steps-slider-value="${s}"]`).dataset.sliderSlideIndex;this.sliderInstance.slideTo(this.sliderContainer,i,{noEvent:!0}),this.renderTemplateBlockControls(!0,s)}function n(e){if(l(e.currentTarget))return;const t=this.rootElem.querySelector(`[data-steps-slider-value="${this.mainValue}"]`).dataset.sliderSlideIndex;this.sliderInstance.slideTo(this.sliderContainer,t,{noEvent:!0}),this.controlBlocks.forEach((e=>{e.classList.remove("__removed"),e.classList.contains("__stays-shown")||e.remove()}))}this.rootElem.insertAdjacentHTML(this.renderPosition,e),this.hasSlider&&(this.mainControlsBlock=this.rootElem.querySelector(".template-block__controls-block"),this.mainControlsBlock.classList.add("template-block__controls--main"),this.mainControls=Array.from(this.mainControlsBlock.querySelectorAll("input[type='radio']")||[]),this.sliderContainer=this.rootElem.querySelector(".slider"),this.sliderContainer.addEventListener("sliderinit",t),setTimeout(t,150),this.mainControls.forEach((e=>{e.addEventListener("change",s);const t=e.nextElementSibling;t.addEventListener("mouseover",i),t.addEventListener("mouseleave",n)})),this.sliderContainer.addEventListener("slidechange",this.onSlideChange))}getControls(e){const t=e.type||"pill";let s;if("image"===t)s="template-block__images-list";else s="template-block__pills-list";let l="";return e.controlItems.forEach((s=>{"image"===t&&(l+=`\n                <li class="template-block__images-item">\n                    <input class="template-block__radio" id="${this.otherParams.name}-${e.controlName}-${s.value}" type="radio"\n                        name="${this.otherParams.name}-${e.controlName}" value="${s.value}">\n                    <label class="template-block__image-label" for="${this.otherParams.name}-${e.controlName}-${s.value}">\n                        <img src="${s.src}"\n                            alt="Превью - ${s.value}" class="template-block__images-img">\n                    </label>\n                </li>\n                `),"pill"===t&&(l+=`\n                <li class="template-block__pill">\n                    <input class="template-block__radio" id="${this.otherParams.name}-${e.controlName}-${s.value}"\n                        type="radio" name="${this.otherParams.name}-${e.controlName}" value="${s.value}">\n                    <label class="template-block__pill-label"\n                        for="${this.otherParams.name}-${e.controlName}-${s.value}">\n                        ${s.iconName?`<span class="template-block__pill-icon ${s.iconName}" style="${s.iconStyle}"></span>`:""}\n                        <span class="template-block__pill-text" style="${s.textStyle}">\n                            ${s.title}\n                        </span>\n                    </label>\n                </li>\n                `)})),`\n            <div class="template-block__controls-block">\n                <div class="template-block__controls-headline">\n                    <h3 class="template-block__controls-title">${e.controlTitle}:</h3>\n                    <p class="template-block__controls-name"></p>\n                </div>\n                <ul class="${s}">\n                    ${l}\n                </ul>\n            </div>\n        `}renderTemplateBlockControls(e=!1,t=null){if(this.hasSlider){let s="";(e&&t?this.params.controlItems.find((e=>e.value===t)):this.params.controlItems.find((e=>e.value===this.mainValue))).options.forEach((e=>{s+=this.getControls(e)}));const l=Array.from(this.mainControlsBlock.parentNode.querySelectorAll(".template-block__controls-block:not(.template-block__controls--main)"));e?l.forEach((e=>e.classList.add("__removed"))):l.forEach((e=>e.remove())),this.mainControlsBlock.insertAdjacentHTML("afterend",s),this.controlBlocks=Array.from(this.mainControlsBlock.parentNode.querySelectorAll(".template-block__controls-block:not(.template-block__controls--main)")),this.controlBlocks.forEach((t=>{if(!e){t.classList.add("__stays-shown");t.querySelectorAll("input").forEach((e=>{e.addEventListener("change",this.setImageFilename)}));const e=t.querySelector("input");e.checked=!0,e.dispatchEvent(new Event("change"))}}))}}setImageFilename(){let e="";this.controlBlocks.forEach(((t,s)=>{const l=t.querySelector("input:checked");if(!l)return;const i=l.value;e+=i,s!==this.controlBlocks.length-1&&(e+="_")}));const t=this.params.controlItems.find((e=>e.value===this.mainValue)).fileExtension,s=this.sliderContainer.querySelector(".slider__slide--active").querySelector("img"),l=s.getAttribute("src").split("/");l[l.length-1]=`${e}.${t}`;const i=l.join("/");s.setAttribute("src",i)}setDefaultFilenames(){this.params.controlItems.forEach((e=>{const t=this.rootElem.querySelector(`[data-steps-slider-value="${e.value}"]`).querySelector("img");let s="";e.options.forEach(((e,t,l)=>{s+=e.controlItems[0].value,t!==l.length-1&&(s+="_")}));const l=t.getAttribute("src").split("/");l[l.length-1]=`${s}.${e.fileExtension}`,t.setAttribute("src",l.join("/"))}))}saveControlChecks(){const e=Array.from(this.mainControlsBlock.parentNode.querySelectorAll(".template-block__controls-block:not(.template-block__controls--main)"));this.savedControlsChecks=[],e.forEach((e=>{let t=e.querySelector("input:checked");t||(t=e.querySelector("input"));const s=t.value,l=t.name;this.savedControlsChecks.push({name:l,value:s})}))}returnSavedControlsChecks(){this.savedControlsChecks&&this.savedControlsChecks.forEach((e=>{const t=Array.from(this.rootElem.querySelectorAll(`input[name="${e.name}"]`)).find((t=>t.value===e.value));t&&(t.checked=!0,t.dispatchEvent(new Event("change")))}))}changeSlide(e,t=!1){if(!this.sliderContainer||!this.sliderInstance)return;const s=this.sliderContainer.querySelector(`[data-steps-slider-value="${e}"]`).dataset.sliderSlideIndex;this.sliderInstance.slideTo(this.sliderContainer,s,{noEvent:t})}onSlideChange(e){const t=e.detail.activeSlide.dataset.stepsSliderValue,s=this.mainControls.find((e=>e.value===t));s.checked=!0,s.dispatchEvent(new Event("change")),this.setDefaultFilenames()}}const createTemplateBlocks=[new CreateTemplateBlock(".resume-template",`${rootPath}json/resume-template.json`,{pathToImg:"/job1/img/create-resume/cv-templates/",imgAlt:"Шаблон резюме",name:"resume_template"})];